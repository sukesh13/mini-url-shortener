var shortId = require('shortid');
var bigInt = require('big-integer');
var source = shortId.characters();
var hash = {};

function getHash(){
    var _source = shortId.characters();
    if(_source == source && hash.base){
        return hash;
    }else{
        source = _source;
        return refreshHash();
    }
}

function refreshHash(){
    hash.base = source.length;
    for(var i=hash.base;i--;)
    {
        hash[source.charAt(i)] = i;
    }
    return hash;
}

function toBigInt(source, base){
    var temp = '';
    source.split("").forEach(function(char){
        temp += ['<', hash[char], '>'].join("");
    });
    return bigInt(temp, base);
}

function generate() {
    generate.source = shortId();
    return toBigInt(generate.source, getHash().base);
}

module.exports = generate;
module.exports.generate = generate;
